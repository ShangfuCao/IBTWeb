{"ast":null,"code":"import _classCallCheck from \"/Users/shangfualexcao/Dropbox (Personal)/My Mac (Shangfu\\u2019s MacBook Pro)/Documents/GitHub/IBT-Web/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/shangfualexcao/Dropbox (Personal)/My Mac (Shangfu\\u2019s MacBook Pro)/Documents/GitHub/IBT-Web/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/Users/shangfualexcao/Dropbox (Personal)/My Mac (Shangfu\\u2019s MacBook Pro)/Documents/GitHub/IBT-Web/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"/Users/shangfualexcao/Dropbox (Personal)/My Mac (Shangfu\\u2019s MacBook Pro)/Documents/GitHub/IBT-Web/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nimport { CylinderGeometry, DoubleSide, Mesh, MeshBasicMaterial, Object3D, Plane, PlaneGeometry } from 'three';\nimport { TransformControls } from 'three/examples/jsm/controls/TransformControls';\nimport { IfcComponent } from '../../../base-types';\nexport var IfcPlane = /*#__PURE__*/function (_IfcComponent) {\n  _inherits(IfcPlane, _IfcComponent);\n\n  var _super = _createSuper(IfcPlane);\n\n  function IfcPlane(context, origin, normal, onStartDragging, onEndDragging, planeSize) {\n    var _this;\n\n    _classCallCheck(this, IfcPlane);\n\n    _this = _super.call(this, context);\n    _this.arrowBoundingBox = new Mesh();\n\n    _this.removeFromScene = function () {\n      var scene = _this.context.getScene();\n\n      scene.remove(_this.helper);\n      scene.remove(_this.controls);\n    };\n\n    _this.planeSize = planeSize;\n    _this.context = context;\n    _this.plane = new Plane();\n    _this.planeMesh = _this.getPlaneMesh();\n    _this.visible = true;\n    _this.normal = normal;\n    _this.origin = origin;\n    _this.helper = _this.createHelper();\n    _this.controls = _this.newTransformControls();\n\n    _this.setupEvents(onStartDragging, onEndDragging);\n\n    _this.plane.setFromNormalAndCoplanarPoint(normal, origin);\n\n    return _this;\n  }\n\n  _createClass(IfcPlane, [{\n    key: \"setVisibility\",\n    value: function setVisibility(visible) {\n      this.visible = visible;\n      this.helper.visible = visible;\n      this.controls.visible = visible;\n    }\n  }, {\n    key: \"newTransformControls\",\n    value: function newTransformControls() {\n      var camera = this.context.getCamera();\n      var container = this.context.getDomElement();\n      var controls = new TransformControls(camera, container);\n      this.initializeControls(controls);\n      var scene = this.context.getScene();\n      scene.add(controls);\n      return controls;\n    }\n  }, {\n    key: \"initializeControls\",\n    value: function initializeControls(controls) {\n      controls.attach(this.helper);\n      controls.showX = false;\n      controls.showY = false;\n      controls.setSpace('local');\n      this.createArrowBoundingBox();\n      controls.children[0].children[0].add(this.arrowBoundingBox);\n    }\n  }, {\n    key: \"createArrowBoundingBox\",\n    value: function createArrowBoundingBox() {\n      this.arrowBoundingBox.geometry = new CylinderGeometry(0.18, 0.18, 1.2);\n      this.arrowBoundingBox.material = IfcPlane.hiddenMaterial;\n      this.arrowBoundingBox.rotateX(Math.PI / 2);\n      this.arrowBoundingBox.updateMatrix();\n      this.arrowBoundingBox.geometry.applyMatrix4(this.arrowBoundingBox.matrix);\n    }\n  }, {\n    key: \"setupEvents\",\n    value: function setupEvents(onStart, onEnd) {\n      var _this2 = this;\n\n      this.controls.addEventListener('change', function () {\n        _this2.plane.setFromNormalAndCoplanarPoint(_this2.normal, _this2.helper.position);\n      });\n      this.controls.addEventListener('dragging-changed', function (event) {\n        _this2.visible = !event.value;\n\n        _this2.context.toggleCameraControls(_this2.visible, {\n          preventOrbitAdjustment: true\n        });\n\n        if (event.value) onStart();else onEnd();\n      });\n      this.context.ifcCamera.currentNavMode.onChangeProjection.on(function (camera) {\n        _this2.controls.camera = camera;\n      });\n    }\n  }, {\n    key: \"createHelper\",\n    value: function createHelper() {\n      var helper = new Object3D();\n      helper.lookAt(this.normal);\n      helper.position.copy(this.origin);\n      var scene = this.context.getScene();\n      scene.add(helper);\n      helper.add(this.planeMesh);\n      return helper;\n    }\n  }, {\n    key: \"getPlaneMesh\",\n    value: function getPlaneMesh() {\n      var planeGeom = new PlaneGeometry(this.planeSize, this.planeSize, 1);\n      return new Mesh(planeGeom, IfcPlane.planeMaterial);\n    }\n  }]);\n\n  return IfcPlane;\n}(IfcComponent);\nIfcPlane.hiddenMaterial = new MeshBasicMaterial({\n  visible: false\n});\nIfcPlane.planeMaterial = new MeshBasicMaterial({\n  color: 0xffff00,\n  side: DoubleSide,\n  transparent: true,\n  opacity: 0.2\n});","map":{"version":3,"sources":["../../../../src/components/display/clipping-planes/planes.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { CylinderGeometry, DoubleSide, Mesh, MeshBasicMaterial, Object3D, Plane, PlaneGeometry } from 'three';\r\nimport { TransformControls } from 'three/examples/jsm/controls/TransformControls';\r\nimport { IfcComponent } from '../../../base-types';\r\nexport class IfcPlane extends IfcComponent {\r\n    constructor(context, origin, normal, onStartDragging, onEndDragging, planeSize) {\r\n        super(context);\r\n        this.arrowBoundingBox = new Mesh();\r\n        this.removeFromScene = () => {\r\n            const scene = this.context.getScene();\r\n            scene.remove(this.helper);\r\n            scene.remove(this.controls);\r\n        };\r\n        this.planeSize = planeSize;\r\n        this.context = context;\r\n        this.plane = new Plane();\r\n        this.planeMesh = this.getPlaneMesh();\r\n        this.visible = true;\r\n        this.normal = normal;\r\n        this.origin = origin;\r\n        this.helper = this.createHelper();\r\n        this.controls = this.newTransformControls();\r\n        this.setupEvents(onStartDragging, onEndDragging);\r\n        this.plane.setFromNormalAndCoplanarPoint(normal, origin);\r\n    }\r\n    setVisibility(visible) {\r\n        this.visible = visible;\r\n        this.helper.visible = visible;\r\n        this.controls.visible = visible;\r\n    }\r\n    newTransformControls() {\r\n        const camera = this.context.getCamera();\r\n        const container = this.context.getDomElement();\r\n        const controls = new TransformControls(camera, container);\r\n        this.initializeControls(controls);\r\n        const scene = this.context.getScene();\r\n        scene.add(controls);\r\n        return controls;\r\n    }\r\n    initializeControls(controls) {\r\n        controls.attach(this.helper);\r\n        controls.showX = false;\r\n        controls.showY = false;\r\n        controls.setSpace('local');\r\n        this.createArrowBoundingBox();\r\n        controls.children[0].children[0].add(this.arrowBoundingBox);\r\n    }\r\n    createArrowBoundingBox() {\r\n        this.arrowBoundingBox.geometry = new CylinderGeometry(0.18, 0.18, 1.2);\r\n        this.arrowBoundingBox.material = IfcPlane.hiddenMaterial;\r\n        this.arrowBoundingBox.rotateX(Math.PI / 2);\r\n        this.arrowBoundingBox.updateMatrix();\r\n        this.arrowBoundingBox.geometry.applyMatrix4(this.arrowBoundingBox.matrix);\r\n    }\r\n    setupEvents(onStart, onEnd) {\r\n        this.controls.addEventListener('change', () => {\r\n            this.plane.setFromNormalAndCoplanarPoint(this.normal, this.helper.position);\r\n        });\r\n        this.controls.addEventListener('dragging-changed', (event) => {\r\n            this.visible = !event.value;\r\n            this.context.toggleCameraControls(this.visible, { preventOrbitAdjustment: true });\r\n            if (event.value)\r\n                onStart();\r\n            else\r\n                onEnd();\r\n        });\r\n        this.context.ifcCamera.currentNavMode.onChangeProjection.on((camera) => {\r\n            this.controls.camera = camera;\r\n        });\r\n    }\r\n    createHelper() {\r\n        const helper = new Object3D();\r\n        helper.lookAt(this.normal);\r\n        helper.position.copy(this.origin);\r\n        const scene = this.context.getScene();\r\n        scene.add(helper);\r\n        helper.add(this.planeMesh);\r\n        return helper;\r\n    }\r\n    getPlaneMesh() {\r\n        const planeGeom = new PlaneGeometry(this.planeSize, this.planeSize, 1);\r\n        return new Mesh(planeGeom, IfcPlane.planeMaterial);\r\n    }\r\n}\r\nIfcPlane.hiddenMaterial = new MeshBasicMaterial({ visible: false });\r\nIfcPlane.planeMaterial = new MeshBasicMaterial({\r\n    color: 0xffff00,\r\n    side: DoubleSide,\r\n    transparent: true,\r\n    opacity: 0.2\r\n});\r\n//# sourceMappingURL=planes.js.map"]},"metadata":{},"sourceType":"module"}