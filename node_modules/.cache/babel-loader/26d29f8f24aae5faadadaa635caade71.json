{"ast":null,"code":"import _classCallCheck from \"/Users/shangfualexcao/Dropbox (Personal)/My Mac (Shangfu\\u2019s MacBook Pro)/Documents/GitHub/IBT-Web/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/shangfualexcao/Dropbox (Personal)/My Mac (Shangfu\\u2019s MacBook Pro)/Documents/GitHub/IBT-Web/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport { BlendFunction, EffectComposer, EffectPass, NormalPass, RenderPass, SSAOEffect // @ts-ignore\n} from 'postprocessing';\nimport { WebGLRenderer } from 'three';\nimport { IfcEvent } from '../ifcEvent';\nexport var IfcPostproduction = /*#__PURE__*/function () {\n  function IfcPostproduction(context, canvas) {\n    _classCallCheck(this, IfcPostproduction);\n\n    this.context = context;\n    this.setupEvents();\n    this.renderer = new WebGLRenderer({\n      canvas: canvas,\n      powerPreference: 'high-performance',\n      antialias: false,\n      stencil: false,\n      depth: false\n    });\n    this.renderer.localClippingEnabled = true;\n    this.composer = new EffectComposer(this.renderer);\n  }\n\n  _createClass(IfcPostproduction, [{\n    key: \"domElement\",\n    get: function get() {\n      return this.renderer.domElement;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      this.composer.render();\n    }\n  }, {\n    key: \"setSize\",\n    value: function setSize(width, height) {\n      this.composer.setSize(width, height);\n    }\n  }, {\n    key: \"setupEvents\",\n    value: function setupEvents() {\n      var _this = this;\n\n      var createPasses = function createPasses(scene, camera) {\n        var normalPass = new NormalPass(scene, camera, {\n          resolutionScale: 1.0\n        });\n        _this.ssaoEffect = new SSAOEffect(camera, normalPass.renderTarget.texture, {\n          blendFunction: BlendFunction.MULTIPLY,\n          // blendFunction: POSTPROCESSING.BlendFunction.ALPHA,\n          samples: 32,\n          rings: 5,\n          distanceThreshold: 0.0,\n          distanceFalloff: 1.0,\n          rangeThreshold: 0.0,\n          rangeFalloff: 1.0,\n          luminanceInfluence: 0.0,\n          scale: 0.6,\n          radius: 0.03,\n          bias: 0.03,\n          intensity: 10.0\n        });\n        _this.ssaoEffect.ssaoMaterial.uniforms.fade.value = 1;\n        _this.ssaoEffect.resolution.scale = 1.5;\n        _this.ssaoEffect.blendMode.opacity.value = 1.2; // Scale, Bias and Opacity influence intensity.\n\n        _this.ssaoEffect.blendMode.opacity.value = 1.0;\n        var renderPass = new RenderPass(scene, camera);\n        var effectPass = new EffectPass(camera, _this.ssaoEffect);\n        effectPass.renderToScreen = true;\n        return [renderPass, normalPass, effectPass];\n      };\n\n      var setupPasses = function setupPasses(scene, camera) {\n        var passes = createPasses(scene, camera);\n        passes.forEach(function (pass) {\n          return _this.composer.addPass(pass);\n        });\n      };\n\n      this.context.events.subscribe(IfcEvent.onCameraReady, function () {\n        var scene = _this.context.getScene();\n\n        var camera = _this.context.ifcCamera;\n        camera.onChangeProjection.on(function (camera) {\n          _this.composer.removeAllPasses();\n\n          setupPasses(_this.context.getScene(), camera);\n        });\n        setupPasses(scene, camera.activeCamera);\n      });\n    }\n  }]);\n\n  return IfcPostproduction;\n}();","map":{"version":3,"sources":["../../../../src/components/context/renderer/postproduction.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { BlendFunction, EffectComposer, EffectPass, NormalPass, RenderPass, SSAOEffect\r\n// @ts-ignore\r\n } from 'postprocessing';\r\nimport { WebGLRenderer } from 'three';\r\nimport { IfcEvent } from '../ifcEvent';\r\nexport class IfcPostproduction {\r\n    constructor(context, canvas) {\r\n        this.context = context;\r\n        this.setupEvents();\r\n        this.renderer = new WebGLRenderer({\r\n            canvas,\r\n            powerPreference: 'high-performance',\r\n            antialias: false,\r\n            stencil: false,\r\n            depth: false\r\n        });\r\n        this.renderer.localClippingEnabled = true;\r\n        this.composer = new EffectComposer(this.renderer);\r\n    }\r\n    get domElement() {\r\n        return this.renderer.domElement;\r\n    }\r\n    render() {\r\n        this.composer.render();\r\n    }\r\n    setSize(width, height) {\r\n        this.composer.setSize(width, height);\r\n    }\r\n    setupEvents() {\r\n        const createPasses = (scene, camera) => {\r\n            const normalPass = new NormalPass(scene, camera, {\r\n                resolutionScale: 1.0\r\n            });\r\n            this.ssaoEffect = new SSAOEffect(camera, normalPass.renderTarget.texture, {\r\n                blendFunction: BlendFunction.MULTIPLY,\r\n                // blendFunction: POSTPROCESSING.BlendFunction.ALPHA,\r\n                samples: 32,\r\n                rings: 5,\r\n                distanceThreshold: 0.0,\r\n                distanceFalloff: 1.0,\r\n                rangeThreshold: 0.0,\r\n                rangeFalloff: 1.0,\r\n                luminanceInfluence: 0.0,\r\n                scale: 0.6,\r\n                radius: 0.03,\r\n                bias: 0.03,\r\n                intensity: 10.0\r\n            });\r\n            this.ssaoEffect.ssaoMaterial.uniforms.fade.value = 1;\r\n            this.ssaoEffect.resolution.scale = 1.5;\r\n            this.ssaoEffect.blendMode.opacity.value = 1.2;\r\n            // Scale, Bias and Opacity influence intensity.\r\n            this.ssaoEffect.blendMode.opacity.value = 1.0;\r\n            const renderPass = new RenderPass(scene, camera);\r\n            const effectPass = new EffectPass(camera, this.ssaoEffect);\r\n            effectPass.renderToScreen = true;\r\n            return [renderPass, normalPass, effectPass];\r\n        };\r\n        const setupPasses = (scene, camera) => {\r\n            const passes = createPasses(scene, camera);\r\n            passes.forEach((pass) => this.composer.addPass(pass));\r\n        };\r\n        this.context.events.subscribe(IfcEvent.onCameraReady, () => {\r\n            const scene = this.context.getScene();\r\n            const camera = this.context.ifcCamera;\r\n            camera.onChangeProjection.on((camera) => {\r\n                this.composer.removeAllPasses();\r\n                setupPasses(this.context.getScene(), camera);\r\n            });\r\n            setupPasses(scene, camera.activeCamera);\r\n        });\r\n    }\r\n}\r\n//# sourceMappingURL=postproduction.js.map"]},"metadata":{},"sourceType":"module"}