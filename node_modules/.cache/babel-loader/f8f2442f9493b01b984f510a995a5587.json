{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/shangfualexcao/Dropbox (Personal)/My Mac (Shangfu\\u2019s MacBook Pro)/Documents/GitHub/IBT-Web/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _slicedToArray = require(\"/Users/shangfualexcao/Dropbox (Personal)/My Mac (Shangfu\\u2019s MacBook Pro)/Documents/GitHub/IBT-Web/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/slicedToArray\");\n\nvar _classCallCheck = require(\"/Users/shangfualexcao/Dropbox (Personal)/My Mac (Shangfu\\u2019s MacBook Pro)/Documents/GitHub/IBT-Web/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Topic = exports.BcfReader = void 0;\n\nvar Helpers_1 = require(\"./Helpers\");\n\nvar unzipit_1 = require(\"unzipit\");\n\nvar BcfReader = function BcfReader() {\n  var _this = this;\n\n  _classCallCheck(this, BcfReader);\n\n  this.topics = [];\n\n  this.read = function (src) {\n    return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var topics, entries, _i, _Object$entries, _Object$entries$_i, name, entry, i, t, topic;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              topics = [];\n              _context.next = 4;\n              return unzipit_1.unzip(src);\n\n            case 4:\n              this.bcf_archive = _context.sent;\n              entries = this.bcf_archive.entries;\n\n              for (_i = 0, _Object$entries = Object.entries(entries); _i < _Object$entries.length; _i++) {\n                _Object$entries$_i = _slicedToArray(_Object$entries[_i], 2), name = _Object$entries$_i[0], entry = _Object$entries$_i[1];\n\n                if (name.endsWith('.bcf')) {\n                  topics.push(entry);\n                }\n              }\n\n              i = 0;\n\n            case 8:\n              if (!(i < topics.length)) {\n                _context.next = 17;\n                break;\n              }\n\n              t = topics[i];\n              topic = new Topic(this, t);\n              _context.next = 13;\n              return topic.read();\n\n            case 13:\n              this.topics.push(topic);\n\n            case 14:\n              i++;\n              _context.next = 8;\n              break;\n\n            case 17:\n              _context.next = 23;\n              break;\n\n            case 19:\n              _context.prev = 19;\n              _context.t0 = _context[\"catch\"](0);\n              console.log(\"Error in loading BCF archive. The error below was thrown.\");\n              console.error(_context.t0);\n\n            case 23:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this, [[0, 19]]);\n    }));\n  };\n\n  this.getEntry = function (name) {\n    var _a;\n\n    return (_a = _this.bcf_archive) === null || _a === void 0 ? void 0 : _a.entries[name];\n  };\n};\n\nexports.BcfReader = BcfReader;\n\nvar Topic = function Topic(reader, markup) {\n  var _this2 = this;\n\n  _classCallCheck(this, Topic);\n\n  this.viewpoints = [];\n\n  this.read = function () {\n    return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return this.parseMarkup();\n\n            case 2:\n              _context2.next = 4;\n              return this.parseViewpoints();\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, this);\n    }));\n  };\n\n  this.parseMarkup = function () {\n    return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.t0 = Helpers_1.Helpers;\n              _context3.next = 3;\n              return this.markup_file.text();\n\n            case 3:\n              _context3.t1 = _context3.sent;\n              this.markup = _context3.t0.GetMarkup.call(_context3.t0, _context3.t1);\n\n            case 5:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, this);\n    }));\n  };\n\n  this.parseViewpoints = function () {\n    return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      var viewpoints, i, entry, key, file, viewpoint;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              if (this.markup) {\n                _context4.next = 2;\n                break;\n              }\n\n              return _context4.abrupt(\"return\");\n\n            case 2:\n              if (!this.markup.viewpoints) {\n                _context4.next = 20;\n                break;\n              }\n\n              viewpoints = this.markup.viewpoints;\n              i = 0;\n\n            case 5:\n              if (!(i < viewpoints.length)) {\n                _context4.next = 20;\n                break;\n              }\n\n              entry = viewpoints[i];\n              key = this.markup.topic.guid + \"/\" + entry.viewpoint;\n              file = this.reader.getEntry(key);\n\n              if (file) {\n                _context4.next = 11;\n                break;\n              }\n\n              throw new Error(\"Missing Visualization Info\");\n\n            case 11:\n              _context4.t0 = Helpers_1.Helpers;\n              _context4.next = 14;\n              return file.text();\n\n            case 14:\n              _context4.t1 = _context4.sent;\n              viewpoint = _context4.t0.GetViewpoint.call(_context4.t0, _context4.t1);\n              this.viewpoints.push(viewpoint); // Helpers.WriteJsonToFile(`./output/${name}/${id}/${entry.viewpoint}.json`, viewpoint);\n\n            case 17:\n              i++;\n              _context4.next = 5;\n              break;\n\n            case 20:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, this);\n    }));\n  };\n\n  this.getViewpointSnapshot = function (viewpoint) {\n    return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n      var entry;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              if (!(!viewpoint || !this.markup)) {\n                _context5.next = 2;\n                break;\n              }\n\n              return _context5.abrupt(\"return\");\n\n            case 2:\n              entry = this.reader.getEntry(\"\".concat(this.markup.topic.guid, \"/\").concat(viewpoint.snapshot));\n\n              if (!entry) {\n                _context5.next = 7;\n                break;\n              }\n\n              _context5.next = 6;\n              return entry.blob();\n\n            case 6:\n              return _context5.abrupt(\"return\", _context5.sent);\n\n            case 7:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5, this);\n    }));\n  };\n\n  this.reader = reader;\n  this.markup_file = markup;\n};\n\nexports.Topic = Topic;","map":{"version":3,"sources":["../src/BcfReader.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Topic = exports.BcfReader = void 0;\r\nconst Helpers_1 = require(\"./Helpers\");\r\nconst unzipit_1 = require(\"unzipit\");\r\nclass BcfReader {\r\n    constructor() {\r\n        this.topics = [];\r\n        this.read = (src) => __awaiter(this, void 0, void 0, function* () {\r\n            try {\r\n                const topics = [];\r\n                this.bcf_archive = yield unzipit_1.unzip(src);\r\n                const { entries } = this.bcf_archive;\r\n                for (const [name, entry] of Object.entries(entries)) {\r\n                    if (name.endsWith('.bcf')) {\r\n                        topics.push(entry);\r\n                    }\r\n                }\r\n                for (let i = 0; i < topics.length; i++) {\r\n                    const t = topics[i];\r\n                    const topic = new Topic(this, t);\r\n                    yield topic.read();\r\n                    this.topics.push(topic);\r\n                }\r\n            }\r\n            catch (e) {\r\n                console.log(\"Error in loading BCF archive. The error below was thrown.\");\r\n                console.error(e);\r\n            }\r\n        });\r\n        this.getEntry = (name) => {\r\n            var _a;\r\n            return (_a = this.bcf_archive) === null || _a === void 0 ? void 0 : _a.entries[name];\r\n        };\r\n    }\r\n}\r\nexports.BcfReader = BcfReader;\r\nclass Topic {\r\n    constructor(reader, markup) {\r\n        this.viewpoints = [];\r\n        this.read = () => __awaiter(this, void 0, void 0, function* () {\r\n            yield this.parseMarkup();\r\n            yield this.parseViewpoints();\r\n        });\r\n        this.parseMarkup = () => __awaiter(this, void 0, void 0, function* () {\r\n            this.markup = Helpers_1.Helpers.GetMarkup(yield this.markup_file.text());\r\n        });\r\n        this.parseViewpoints = () => __awaiter(this, void 0, void 0, function* () {\r\n            if (!this.markup)\r\n                return;\r\n            if (this.markup.viewpoints) {\r\n                const viewpoints = this.markup.viewpoints;\r\n                for (let i = 0; i < viewpoints.length; i++) {\r\n                    const entry = viewpoints[i];\r\n                    const key = this.markup.topic.guid + \"/\" + entry.viewpoint;\r\n                    const file = this.reader.getEntry(key);\r\n                    if (!file)\r\n                        throw new Error(\"Missing Visualization Info\");\r\n                    const viewpoint = Helpers_1.Helpers.GetViewpoint(yield file.text());\r\n                    this.viewpoints.push(viewpoint);\r\n                    // Helpers.WriteJsonToFile(`./output/${name}/${id}/${entry.viewpoint}.json`, viewpoint);\r\n                }\r\n            }\r\n        });\r\n        this.getViewpointSnapshot = (viewpoint) => __awaiter(this, void 0, void 0, function* () {\r\n            if (!viewpoint || !this.markup)\r\n                return;\r\n            const entry = this.reader.getEntry(`${this.markup.topic.guid}/${viewpoint.snapshot}`);\r\n            if (entry) {\r\n                return yield entry.blob();\r\n            }\r\n        });\r\n        this.reader = reader;\r\n        this.markup_file = markup;\r\n    }\r\n}\r\nexports.Topic = Topic;\r\n//# sourceMappingURL=BcfReader.js.map"]},"metadata":{},"sourceType":"script"}