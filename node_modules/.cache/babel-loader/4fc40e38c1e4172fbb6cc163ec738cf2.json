{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Helpers = void 0;\n\nvar fast_xml_parser_1 = __importDefault(require(\"fast-xml-parser\"));\n\nvar Helpers;\n\n(function (Helpers) {\n  var xmlParserOptions = {\n    attributeNamePrefix: \"@_\",\n    ignoreAttributes: false,\n    ignoreNameSpace: true,\n    allowBooleanAttributes: true,\n    parseNodeValue: true,\n    parseAttributeValue: true,\n    trimValues: true\n  };\n\n  function GetMarkup(xmlString) {\n    var _fast_xml_parser_1$de = fast_xml_parser_1.default.parse(xmlString, xmlParserOptions),\n        Markup = _fast_xml_parser_1$de.Markup;\n\n    return {\n      topic: {\n        guid: Markup.Topic['@_Guid'],\n        topic_type: Markup.Topic[\"@_TopicType\"],\n        topic_status: Markup.Topic[\"@_TopicStatus\"],\n        reference_link: Markup.Topic[\"ReferenceLink\"] && Helpers.ObjectToArray(Markup.Topic[\"ReferenceLink\"]),\n        title: Markup.Topic[\"Title\"],\n        priority: Markup.Topic[\"Priority\"],\n        index: Markup.Topic[\"Index\"],\n        labels: Markup.Topic[\"Labels\"] && Helpers.ObjectToArray(Markup.Topic[\"Labels\"]),\n        creation_date: Markup.Topic[\"CreationDate\"],\n        creation_author: Markup.Topic[\"CreationAuthor\"],\n        modified_date: Markup.Topic[\"ModifiedDate\"],\n        modified_author: Markup.Topic[\"ModifiedAuthor\"],\n        assigned_to: Markup.Topic[\"AssignedTo\"],\n        description: Markup.Topic[\"Description\"]\n      },\n      comments: Helpers.GetComments(Markup.Comment),\n      viewpoints: Helpers.GetViewpoints(Markup.Viewpoints)\n    };\n  }\n\n  Helpers.GetMarkup = GetMarkup;\n\n  function GetVisInfoComponent(xmlData) {\n    return {\n      ifc_guid: xmlData[\"@_IfcGuid\"]\n    };\n  }\n\n  Helpers.GetVisInfoComponent = GetVisInfoComponent;\n\n  function GetViewpoint(xmlString) {\n    var _fast_xml_parser_1$de2 = fast_xml_parser_1.default.parse(xmlString, xmlParserOptions),\n        VisualizationInfo = _fast_xml_parser_1$de2.VisualizationInfo;\n\n    var Vis = VisualizationInfo; //Camera\n\n    var orthogonal_camera = Vis[\"OrthogonalCamera\"];\n    var perspective_camera = Vis[\"PerspectiveCamera\"]; //Extras\n\n    var lines = Vis[\"Lines\"];\n    var clipping_planes = Vis[\"ClippingPlanes\"];\n\n    var GetComponents = function GetComponents() {\n      if (!Vis[\"Components\"]) return undefined;\n      var components = Vis[\"Components\"];\n\n      var GetViewSetupHints = function GetViewSetupHints() {\n        if (!components[\"ViewSetupHints\"]) return undefined;\n        var view_setup_hints = components[\"ViewSetupHints\"];\n        return {\n          spaces_visible: view_setup_hints[\"@_SpacesVisible\"],\n          spaces_boundaries_visible: view_setup_hints[\"@_SpacesBoundariesVisible\"],\n          openings_visible: view_setup_hints[\"@_OpeningsVisible\"]\n        };\n      };\n\n      var GetVisibility = function GetVisibility() {\n        var _a;\n\n        if (!components[\"Visibility\"]) throw new Error(\"Visibility not found.\");\n        var visibility = components[\"Visibility\"];\n        return {\n          default_visibility: visibility[\"@_DefaultVisibility\"],\n          exceptions: visibility[\"Exceptions\"] && visibility[\"Exceptions\"][\"Component\"] && ((_a = Helpers.ObjectToArray(visibility[\"Exceptions\"][\"Component\"])) === null || _a === void 0 ? void 0 : _a.map(function (exception) {\n            return Helpers.GetVisInfoComponent(exception);\n          }))\n        };\n      };\n\n      var GetSelection = function GetSelection() {\n        if (!components[\"Selection\"]) return undefined;\n        var selection = components[\"Selection\"];\n        var arr = Helpers.ObjectToArray(selection[\"Component\"]);\n        return arr === null || arr === void 0 ? void 0 : arr.map(function (exception) {\n          return Helpers.GetVisInfoComponent(exception);\n        });\n      };\n\n      var GetColoring = function GetColoring() {\n        if (!components[\"Coloring\"]) return undefined;\n        var coloring = components[\"Coloring\"];\n        var colors = coloring[\"Color\"];\n        if (!colors) return undefined;\n        return Helpers.ObjectToArray(colors).map(function (color) {\n          return {\n            color: color[\"@_Color\"],\n            components: Helpers.ObjectToArray(color[\"Component\"]).map(function (exception) {\n              return Helpers.GetVisInfoComponent(exception);\n            })\n          };\n        });\n      };\n\n      return {\n        view_setup_hints: GetViewSetupHints(),\n        visibility: GetVisibility(),\n        selection: GetSelection(),\n        coloring: GetColoring()\n      };\n    }; // Helpers.WriteJsonToFile(\"./parsed/viewpoint\" + Vis[\"@_Guid\"] + \".json\", Vis);\n\n\n    return {\n      guid: Vis[\"@_Guid\"],\n      components: GetComponents(),\n      orthogonal_camera: orthogonal_camera && {\n        camera_view_point: ParsePoint(orthogonal_camera[\"CameraViewPoint\"]),\n        camera_direction: ParsePoint(orthogonal_camera[\"CameraDirection\"]),\n        camera_up_vector: ParsePoint(orthogonal_camera[\"CameraUpVector\"]),\n        view_to_world_scale: orthogonal_camera[\"ViewToWorldScale\"]\n      },\n      perspective_camera: perspective_camera && {\n        camera_view_point: ParsePoint(perspective_camera[\"CameraViewPoint\"]),\n        camera_direction: ParsePoint(perspective_camera[\"CameraDirection\"]),\n        camera_up_vector: ParsePoint(perspective_camera[\"CameraUpVector\"]),\n        field_of_view: perspective_camera[\"FieldOfView\"]\n      }\n    };\n  }\n\n  Helpers.GetViewpoint = GetViewpoint;\n\n  function GetViewpoints(data) {\n    if (!data) return;\n\n    var constructViewpoint = function constructViewpoint(data) {\n      return {\n        guid: data[\"@_Guid\"],\n        viewpoint: data[\"Viewpoint\"],\n        snapshot: data[\"Snapshot\"]\n      };\n    };\n\n    var viewpoints = [];\n\n    if (Array.isArray(data)) {\n      data.forEach(function (x) {\n        viewpoints.push(constructViewpoint(x));\n      });\n    } else {\n      viewpoints.push(constructViewpoint(data));\n    }\n\n    return viewpoints;\n  }\n\n  Helpers.GetViewpoints = GetViewpoints;\n\n  function GetComments(data) {\n    if (!data) return;\n\n    var constructComment = function constructComment(data) {\n      var _a;\n\n      return {\n        guid: data[\"@_Guid\"],\n        date: data[\"Date\"],\n        author: data[\"Author\"],\n        comment: data[\"Comment\"],\n        viewpoint: (_a = data === null || data === void 0 ? void 0 : data.Viewpoint) === null || _a === void 0 ? void 0 : _a[\"@_Guid\"],\n        modified_date: data[\"ModifiedDate\"],\n        modified_author: data[\"ModifiedAuthor\"]\n      };\n    };\n\n    var viewpoints = [];\n\n    if (Array.isArray(data)) {\n      data.forEach(function (x) {\n        viewpoints.push(constructComment(x));\n      });\n    } else {\n      viewpoints.push(constructComment(data));\n    }\n\n    return viewpoints;\n  }\n\n  Helpers.GetComments = GetComments;\n  /**\r\n   * Returns an object as an array\r\n   * Can also accept array and returns new array if type is unknown\r\n   *\r\n   * @return data as an array\r\n   * @param data\r\n   */\n\n  function ObjectToArray(data) {\n    return Array.isArray(data) ? data : [data];\n  }\n\n  Helpers.ObjectToArray = ObjectToArray;\n\n  function ParsePoint(point) {\n    return {\n      x: point.X,\n      y: point.Y,\n      z: point.Z\n    };\n  }\n\n  Helpers.ParsePoint = ParsePoint;\n})(Helpers = exports.Helpers || (exports.Helpers = {}));","map":{"version":3,"sources":["../src/Helpers.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Helpers = void 0;\r\nconst fast_xml_parser_1 = __importDefault(require(\"fast-xml-parser\"));\r\nvar Helpers;\r\n(function (Helpers) {\r\n    const xmlParserOptions = {\r\n        attributeNamePrefix: \"@_\",\r\n        ignoreAttributes: false,\r\n        ignoreNameSpace: true,\r\n        allowBooleanAttributes: true,\r\n        parseNodeValue: true,\r\n        parseAttributeValue: true,\r\n        trimValues: true,\r\n    };\r\n    function GetMarkup(xmlString) {\r\n        const { Markup } = fast_xml_parser_1.default.parse(xmlString, xmlParserOptions);\r\n        return {\r\n            topic: {\r\n                guid: Markup.Topic['@_Guid'],\r\n                topic_type: Markup.Topic[\"@_TopicType\"],\r\n                topic_status: Markup.Topic[\"@_TopicStatus\"],\r\n                reference_link: Markup.Topic[\"ReferenceLink\"] && Helpers.ObjectToArray(Markup.Topic[\"ReferenceLink\"]),\r\n                title: Markup.Topic[\"Title\"],\r\n                priority: Markup.Topic[\"Priority\"],\r\n                index: Markup.Topic[\"Index\"],\r\n                labels: Markup.Topic[\"Labels\"] && Helpers.ObjectToArray(Markup.Topic[\"Labels\"]),\r\n                creation_date: Markup.Topic[\"CreationDate\"],\r\n                creation_author: Markup.Topic[\"CreationAuthor\"],\r\n                modified_date: Markup.Topic[\"ModifiedDate\"],\r\n                modified_author: Markup.Topic[\"ModifiedAuthor\"],\r\n                assigned_to: Markup.Topic[\"AssignedTo\"],\r\n                description: Markup.Topic[\"Description\"],\r\n            },\r\n            comments: Helpers.GetComments(Markup.Comment),\r\n            viewpoints: Helpers.GetViewpoints(Markup.Viewpoints)\r\n        };\r\n    }\r\n    Helpers.GetMarkup = GetMarkup;\r\n    function GetVisInfoComponent(xmlData) {\r\n        return {\r\n            ifc_guid: xmlData[\"@_IfcGuid\"]\r\n        };\r\n    }\r\n    Helpers.GetVisInfoComponent = GetVisInfoComponent;\r\n    function GetViewpoint(xmlString) {\r\n        const { VisualizationInfo } = fast_xml_parser_1.default.parse(xmlString, xmlParserOptions);\r\n        const Vis = VisualizationInfo;\r\n        //Camera\r\n        const orthogonal_camera = Vis[\"OrthogonalCamera\"];\r\n        const perspective_camera = Vis[\"PerspectiveCamera\"];\r\n        //Extras\r\n        const lines = Vis[\"Lines\"];\r\n        const clipping_planes = Vis[\"ClippingPlanes\"];\r\n        const GetComponents = () => {\r\n            if (!Vis[\"Components\"])\r\n                return undefined;\r\n            const components = Vis[\"Components\"];\r\n            const GetViewSetupHints = () => {\r\n                if (!components[\"ViewSetupHints\"])\r\n                    return undefined;\r\n                const view_setup_hints = components[\"ViewSetupHints\"];\r\n                return {\r\n                    spaces_visible: view_setup_hints[\"@_SpacesVisible\"],\r\n                    spaces_boundaries_visible: view_setup_hints[\"@_SpacesBoundariesVisible\"],\r\n                    openings_visible: view_setup_hints[\"@_OpeningsVisible\"]\r\n                };\r\n            };\r\n            const GetVisibility = () => {\r\n                var _a;\r\n                if (!components[\"Visibility\"])\r\n                    throw new Error(\"Visibility not found.\");\r\n                const visibility = components[\"Visibility\"];\r\n                return {\r\n                    default_visibility: visibility[\"@_DefaultVisibility\"],\r\n                    exceptions: visibility[\"Exceptions\"] &&\r\n                        visibility[\"Exceptions\"][\"Component\"] && ((_a = Helpers.ObjectToArray(visibility[\"Exceptions\"][\"Component\"])) === null || _a === void 0 ? void 0 : _a.map((exception) => {\r\n                        return Helpers.GetVisInfoComponent(exception);\r\n                    }))\r\n                };\r\n            };\r\n            const GetSelection = () => {\r\n                if (!components[\"Selection\"])\r\n                    return undefined;\r\n                const selection = components[\"Selection\"];\r\n                const arr = Helpers.ObjectToArray(selection[\"Component\"]);\r\n                return arr === null || arr === void 0 ? void 0 : arr.map((exception) => {\r\n                    return Helpers.GetVisInfoComponent(exception);\r\n                });\r\n            };\r\n            const GetColoring = () => {\r\n                if (!components[\"Coloring\"])\r\n                    return undefined;\r\n                const coloring = components[\"Coloring\"];\r\n                const colors = coloring[\"Color\"];\r\n                if (!colors)\r\n                    return undefined;\r\n                return Helpers.ObjectToArray(colors).map((color) => ({\r\n                    color: color[\"@_Color\"],\r\n                    components: Helpers.ObjectToArray(color[\"Component\"])\r\n                        .map((exception) => {\r\n                        return Helpers.GetVisInfoComponent(exception);\r\n                    })\r\n                }));\r\n            };\r\n            return {\r\n                view_setup_hints: GetViewSetupHints(),\r\n                visibility: GetVisibility(),\r\n                selection: GetSelection(),\r\n                coloring: GetColoring()\r\n            };\r\n        };\r\n        // Helpers.WriteJsonToFile(\"./parsed/viewpoint\" + Vis[\"@_Guid\"] + \".json\", Vis);\r\n        return {\r\n            guid: Vis[\"@_Guid\"],\r\n            components: GetComponents(),\r\n            orthogonal_camera: orthogonal_camera && {\r\n                camera_view_point: ParsePoint(orthogonal_camera[\"CameraViewPoint\"]),\r\n                camera_direction: ParsePoint(orthogonal_camera[\"CameraDirection\"]),\r\n                camera_up_vector: ParsePoint(orthogonal_camera[\"CameraUpVector\"]),\r\n                view_to_world_scale: orthogonal_camera[\"ViewToWorldScale\"]\r\n            },\r\n            perspective_camera: perspective_camera && {\r\n                camera_view_point: ParsePoint(perspective_camera[\"CameraViewPoint\"]),\r\n                camera_direction: ParsePoint(perspective_camera[\"CameraDirection\"]),\r\n                camera_up_vector: ParsePoint(perspective_camera[\"CameraUpVector\"]),\r\n                field_of_view: perspective_camera[\"FieldOfView\"]\r\n            },\r\n        };\r\n    }\r\n    Helpers.GetViewpoint = GetViewpoint;\r\n    function GetViewpoints(data) {\r\n        if (!data)\r\n            return;\r\n        const constructViewpoint = (data) => {\r\n            return {\r\n                guid: data[\"@_Guid\"],\r\n                viewpoint: data[\"Viewpoint\"],\r\n                snapshot: data[\"Snapshot\"]\r\n            };\r\n        };\r\n        const viewpoints = [];\r\n        if (Array.isArray(data)) {\r\n            data.forEach((x) => {\r\n                viewpoints.push(constructViewpoint(x));\r\n            });\r\n        }\r\n        else {\r\n            viewpoints.push(constructViewpoint(data));\r\n        }\r\n        return viewpoints;\r\n    }\r\n    Helpers.GetViewpoints = GetViewpoints;\r\n    function GetComments(data) {\r\n        if (!data)\r\n            return;\r\n        const constructComment = (data) => {\r\n            var _a;\r\n            return {\r\n                guid: data[\"@_Guid\"],\r\n                date: data[\"Date\"],\r\n                author: data[\"Author\"],\r\n                comment: data[\"Comment\"],\r\n                viewpoint: (_a = data === null || data === void 0 ? void 0 : data.Viewpoint) === null || _a === void 0 ? void 0 : _a[\"@_Guid\"],\r\n                modified_date: data[\"ModifiedDate\"],\r\n                modified_author: data[\"ModifiedAuthor\"]\r\n            };\r\n        };\r\n        const viewpoints = [];\r\n        if (Array.isArray(data)) {\r\n            data.forEach((x) => {\r\n                viewpoints.push(constructComment(x));\r\n            });\r\n        }\r\n        else {\r\n            viewpoints.push(constructComment(data));\r\n        }\r\n        return viewpoints;\r\n    }\r\n    Helpers.GetComments = GetComments;\r\n    /**\r\n     * Returns an object as an array\r\n     * Can also accept array and returns new array if type is unknown\r\n     *\r\n     * @return data as an array\r\n     * @param data\r\n     */\r\n    function ObjectToArray(data) {\r\n        return Array.isArray(data) ? data : [data];\r\n    }\r\n    Helpers.ObjectToArray = ObjectToArray;\r\n    function ParsePoint(point) {\r\n        return {\r\n            x: point.X,\r\n            y: point.Y,\r\n            z: point.Z\r\n        };\r\n    }\r\n    Helpers.ParsePoint = ParsePoint;\r\n})(Helpers = exports.Helpers || (exports.Helpers = {}));\r\n//# sourceMappingURL=Helpers.js.map"]},"metadata":{},"sourceType":"script"}