{"ast":null,"code":"import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\nimport { Box3, MathUtils, MOUSE, Vector3 } from 'three';\nimport { CameraProjections, IfcComponent, NavigationModes } from '../../../base-types';\nimport { LiteEvent } from '../../../utils/LiteEvent';\nexport class OrbitControl extends IfcComponent {\n  constructor(context, perspectiveCamera, orthographicCamera) {\n    super(context);\n    this.context = context;\n    this.perspectiveCamera = perspectiveCamera;\n    this.orthographicCamera = orthographicCamera;\n    this.enabled = true;\n    this.mode = NavigationModes.Orbit;\n    this.onChange = new LiteEvent();\n    this.onUnlock = new LiteEvent();\n    this.onChangeProjection = new LiteEvent();\n    this.currentTarget = new Vector3();\n    this.startView = {\n      target: new Vector3(),\n      camera: new Vector3(20, 20, 20)\n    };\n\n    this.targetItem = (mesh, duration) => {\n      const center = this.context.getCenter(mesh);\n      const cameraEnd = new Vector3().subVectors(this.perspectiveCamera.position, this.currentTarget).add(center);\n      this.context.getAnimator().move(this.perspectiveCamera.position, cameraEnd, duration);\n      this.context.getAnimator().move(this.orbitControls.target, center, duration);\n    };\n\n    this.currentCamera = this.perspectiveCamera;\n    this.orbitControls = new OrbitControls(this.perspectiveCamera, context.getDomElement()); // this.orbitControls.minDistance = 1;\n    // this.orbitControls.maxDistance = 500;\n    // this.orbitControls.minZoom = 1;\n    // this.orbitControls.maxZoom = 500;\n\n    this.orbitControls.addEventListener('change', event => {\n      this.currentTarget.copy(this.orbitControls.target);\n      this.onChange.trigger(event);\n    });\n    this.setupOrbitControls();\n  }\n\n  get activeCamera() {\n    return this.orbitControls.object;\n  }\n\n  get target() {\n    return this.orbitControls.target;\n  }\n\n  set minDistance(min) {\n    this.orbitControls.minDistance = min;\n  }\n\n  set maxDistance(max) {\n    this.orbitControls.maxDistance = max;\n  }\n\n  set homeView(_ref) {\n    let {\n      camera,\n      target\n    } = _ref;\n    this.startView.camera = camera;\n    this.startView.target = target;\n  }\n\n  get projection() {\n    return this.activeCamera === this.perspectiveCamera ? CameraProjections.Perspective : CameraProjections.Orthographic;\n  }\n\n  set projection(projection) {\n    if (this.projection === projection) return;\n\n    if (projection === CameraProjections.Orthographic) {\n      // Matching orthographic camera to perspective camera\n      // Resource: https://stackoverflow.com/questions/48758959/what-is-required-to-convert-threejs-perspective-camera-to-orthographic\n      const lineOfSight = new Vector3();\n      this.perspectiveCamera.getWorldDirection(lineOfSight);\n      const distance = this.target.clone().sub(this.perspectiveCamera.position);\n      const depth = distance.dot(lineOfSight);\n      const dims = this.context.getDimensions();\n      const aspect = dims.x / dims.y;\n      const height = depth * 2 * Math.atan(this.perspectiveCamera.fov * (Math.PI / 180) / 2);\n      const width = height * aspect;\n      this.orthographicCamera.zoom = 1;\n      this.orthographicCamera.left = width / -2;\n      this.orthographicCamera.right = width / 2;\n      this.orthographicCamera.top = height / 2;\n      this.orthographicCamera.bottom = height / -2;\n      this.orthographicCamera.updateProjectionMatrix();\n      this.orthographicCamera.position.copy(this.perspectiveCamera.position);\n      this.orthographicCamera.quaternion.copy(this.perspectiveCamera.quaternion);\n      this.orbitControls.object = this.orthographicCamera;\n      this.currentCamera = this.orthographicCamera;\n    } else {\n      this.perspectiveCamera.position.copy(this.orthographicCamera.position);\n      this.perspectiveCamera.quaternion.copy(this.orthographicCamera.quaternion);\n      this.perspectiveCamera.updateProjectionMatrix();\n      this.orbitControls.object = this.perspectiveCamera;\n      this.currentCamera = this.perspectiveCamera;\n    }\n  }\n\n  setOrbitControlsButtons(buttons) {\n    this.orbitControls.mouseButtons = {\n      LEFT: buttons.left,\n      MIDDLE: buttons.middle,\n      RIGHT: buttons.right\n    };\n  }\n\n  update(_delta) {\n    if (this.enabled) {\n      this.orbitControls.update();\n    }\n  }\n  /**\r\n   * @deprecated Use onChange.on() instead.\r\n   */\n\n\n  submitOnChange(action) {\n    this.onChange.on(action);\n  }\n  /**\r\n   * @deprecated Use onChange.on() instead.\r\n   */\n\n\n  submitOnUnlock(action) {\n    this.onUnlock.on(action);\n  }\n\n  toggleProjection() {\n    if (this.activeCamera === this.perspectiveCamera) {\n      this.projection = CameraProjections.Orthographic;\n    } else {\n      this.projection = CameraProjections.Perspective;\n    }\n\n    this.onChangeProjection.trigger(this.activeCamera);\n  }\n\n  toggle(active, options) {\n    const preventAdjustment = options !== undefined && options.preventOrbitAdjustment;\n\n    if (active && !preventAdjustment) {\n      this.adjustTarget();\n    }\n\n    this.enabled = active;\n    this.orbitControls.enabled = active;\n  }\n\n  goTo(position, target, duration) {\n    this.context.getAnimator().move(this.currentCamera.position, position, duration);\n    this.context.getAnimator().move(this.orbitControls.target, target, duration);\n  }\n\n  goToHomeView() {\n    this.context.getAnimator().move(this.perspectiveCamera.position, this.startView.camera);\n    this.context.getAnimator().move(this.orbitControls.target, this.startView.target);\n  }\n\n  fitModelToFrame() {\n    if (!this.enabled) return;\n    const {\n      boxCenter,\n      distance\n    } = this.getBoxCenterAndDistance();\n    const direction = new Vector3().subVectors(this.perspectiveCamera.position, boxCenter).multiply(new Vector3(1, 0, 1)).normalize();\n    this.perspectiveCamera.position.copy(direction.multiplyScalar(distance).add(boxCenter));\n    this.perspectiveCamera.updateProjectionMatrix();\n    this.orbitControls.target.set(boxCenter.x, boxCenter.y, boxCenter.z);\n  }\n\n  getBoxCenterAndDistance() {\n    const scene = this.context.getScene();\n    const box = new Box3().setFromObject(scene.children[scene.children.length - 1]);\n    const boxSize = box.getSize(new Vector3()).length();\n    const boxCenter = box.getCenter(new Vector3());\n    const halfSizeToFitOnScreen = boxSize * 0.5;\n    const halfFovY = MathUtils.degToRad(this.perspectiveCamera.fov * 0.5);\n    const distance = halfSizeToFitOnScreen / Math.tan(halfFovY);\n    return {\n      boxCenter,\n      distance\n    };\n  }\n\n  adjustTarget() {\n    const cameraDir = new Vector3();\n    this.activeCamera.getWorldDirection(cameraDir);\n    cameraDir.multiplyScalar(20);\n    const center = new Vector3().addVectors(cameraDir, this.activeCamera.position);\n    this.orbitControls.target.set(center.x, center.y, center.z);\n  }\n\n  setupOrbitControls() {\n    this.orbitControls.enableDamping = true;\n    this.orbitControls.dampingFactor *= 2;\n    this.orbitControls.target.set(0, 0, 0);\n    const panWithMMB = this.context.options.panWithMMB || true;\n\n    if (panWithMMB) {\n      this.orbitControls.mouseButtons = {\n        RIGHT: MOUSE.RIGHT,\n        MIDDLE: MOUSE.RIGHT,\n        LEFT: MOUSE.LEFT\n      };\n    }\n  }\n\n}","map":{"version":3,"sources":["../../../../src/components/context/camera/OrbitControl.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\r\nimport { Box3, MathUtils, MOUSE, Vector3 } from 'three';\r\nimport { CameraProjections, IfcComponent, NavigationModes } from '../../../base-types';\r\nimport { LiteEvent } from '../../../utils/LiteEvent';\r\nexport class OrbitControl extends IfcComponent {\r\n    constructor(context, perspectiveCamera, orthographicCamera) {\r\n        super(context);\r\n        this.context = context;\r\n        this.perspectiveCamera = perspectiveCamera;\r\n        this.orthographicCamera = orthographicCamera;\r\n        this.enabled = true;\r\n        this.mode = NavigationModes.Orbit;\r\n        this.onChange = new LiteEvent();\r\n        this.onUnlock = new LiteEvent();\r\n        this.onChangeProjection = new LiteEvent();\r\n        this.currentTarget = new Vector3();\r\n        this.startView = {\r\n            target: new Vector3(),\r\n            camera: new Vector3(20, 20, 20)\r\n        };\r\n        this.targetItem = (mesh, duration) => {\r\n            const center = this.context.getCenter(mesh);\r\n            const cameraEnd = new Vector3()\r\n                .subVectors(this.perspectiveCamera.position, this.currentTarget)\r\n                .add(center);\r\n            this.context.getAnimator().move(this.perspectiveCamera.position, cameraEnd, duration);\r\n            this.context.getAnimator().move(this.orbitControls.target, center, duration);\r\n        };\r\n        this.currentCamera = this.perspectiveCamera;\r\n        this.orbitControls = new OrbitControls(this.perspectiveCamera, context.getDomElement());\r\n        // this.orbitControls.minDistance = 1;\r\n        // this.orbitControls.maxDistance = 500;\r\n        // this.orbitControls.minZoom = 1;\r\n        // this.orbitControls.maxZoom = 500;\r\n        this.orbitControls.addEventListener('change', (event) => {\r\n            this.currentTarget.copy(this.orbitControls.target);\r\n            this.onChange.trigger(event);\r\n        });\r\n        this.setupOrbitControls();\r\n    }\r\n    get activeCamera() {\r\n        return this.orbitControls.object;\r\n    }\r\n    get target() {\r\n        return this.orbitControls.target;\r\n    }\r\n    set minDistance(min) {\r\n        this.orbitControls.minDistance = min;\r\n    }\r\n    set maxDistance(max) {\r\n        this.orbitControls.maxDistance = max;\r\n    }\r\n    set homeView({ camera, target }) {\r\n        this.startView.camera = camera;\r\n        this.startView.target = target;\r\n    }\r\n    get projection() {\r\n        return this.activeCamera === this.perspectiveCamera\r\n            ? CameraProjections.Perspective\r\n            : CameraProjections.Orthographic;\r\n    }\r\n    set projection(projection) {\r\n        if (this.projection === projection)\r\n            return;\r\n        if (projection === CameraProjections.Orthographic) {\r\n            // Matching orthographic camera to perspective camera\r\n            // Resource: https://stackoverflow.com/questions/48758959/what-is-required-to-convert-threejs-perspective-camera-to-orthographic\r\n            const lineOfSight = new Vector3();\r\n            this.perspectiveCamera.getWorldDirection(lineOfSight);\r\n            const distance = this.target.clone().sub(this.perspectiveCamera.position);\r\n            const depth = distance.dot(lineOfSight);\r\n            const dims = this.context.getDimensions();\r\n            const aspect = dims.x / dims.y;\r\n            const height = depth * 2 * Math.atan((this.perspectiveCamera.fov * (Math.PI / 180)) / 2);\r\n            const width = height * aspect;\r\n            this.orthographicCamera.zoom = 1;\r\n            this.orthographicCamera.left = width / -2;\r\n            this.orthographicCamera.right = width / 2;\r\n            this.orthographicCamera.top = height / 2;\r\n            this.orthographicCamera.bottom = height / -2;\r\n            this.orthographicCamera.updateProjectionMatrix();\r\n            this.orthographicCamera.position.copy(this.perspectiveCamera.position);\r\n            this.orthographicCamera.quaternion.copy(this.perspectiveCamera.quaternion);\r\n            this.orbitControls.object = this.orthographicCamera;\r\n            this.currentCamera = this.orthographicCamera;\r\n        }\r\n        else {\r\n            this.perspectiveCamera.position.copy(this.orthographicCamera.position);\r\n            this.perspectiveCamera.quaternion.copy(this.orthographicCamera.quaternion);\r\n            this.perspectiveCamera.updateProjectionMatrix();\r\n            this.orbitControls.object = this.perspectiveCamera;\r\n            this.currentCamera = this.perspectiveCamera;\r\n        }\r\n    }\r\n    setOrbitControlsButtons(buttons) {\r\n        this.orbitControls.mouseButtons = {\r\n            LEFT: buttons.left,\r\n            MIDDLE: buttons.middle,\r\n            RIGHT: buttons.right\r\n        };\r\n    }\r\n    update(_delta) {\r\n        if (this.enabled) {\r\n            this.orbitControls.update();\r\n        }\r\n    }\r\n    /**\r\n     * @deprecated Use onChange.on() instead.\r\n     */\r\n    submitOnChange(action) {\r\n        this.onChange.on(action);\r\n    }\r\n    /**\r\n     * @deprecated Use onChange.on() instead.\r\n     */\r\n    submitOnUnlock(action) {\r\n        this.onUnlock.on(action);\r\n    }\r\n    toggleProjection() {\r\n        if (this.activeCamera === this.perspectiveCamera) {\r\n            this.projection = CameraProjections.Orthographic;\r\n        }\r\n        else {\r\n            this.projection = CameraProjections.Perspective;\r\n        }\r\n        this.onChangeProjection.trigger(this.activeCamera);\r\n    }\r\n    toggle(active, options) {\r\n        const preventAdjustment = options !== undefined && options.preventOrbitAdjustment;\r\n        if (active && !preventAdjustment) {\r\n            this.adjustTarget();\r\n        }\r\n        this.enabled = active;\r\n        this.orbitControls.enabled = active;\r\n    }\r\n    goTo(position, target, duration) {\r\n        this.context.getAnimator().move(this.currentCamera.position, position, duration);\r\n        this.context.getAnimator().move(this.orbitControls.target, target, duration);\r\n    }\r\n    goToHomeView() {\r\n        this.context.getAnimator().move(this.perspectiveCamera.position, this.startView.camera);\r\n        this.context.getAnimator().move(this.orbitControls.target, this.startView.target);\r\n    }\r\n    fitModelToFrame() {\r\n        if (!this.enabled)\r\n            return;\r\n        const { boxCenter, distance } = this.getBoxCenterAndDistance();\r\n        const direction = new Vector3()\r\n            .subVectors(this.perspectiveCamera.position, boxCenter)\r\n            .multiply(new Vector3(1, 0, 1))\r\n            .normalize();\r\n        this.perspectiveCamera.position.copy(direction.multiplyScalar(distance).add(boxCenter));\r\n        this.perspectiveCamera.updateProjectionMatrix();\r\n        this.orbitControls.target.set(boxCenter.x, boxCenter.y, boxCenter.z);\r\n    }\r\n    getBoxCenterAndDistance() {\r\n        const scene = this.context.getScene();\r\n        const box = new Box3().setFromObject(scene.children[scene.children.length - 1]);\r\n        const boxSize = box.getSize(new Vector3()).length();\r\n        const boxCenter = box.getCenter(new Vector3());\r\n        const halfSizeToFitOnScreen = boxSize * 0.5;\r\n        const halfFovY = MathUtils.degToRad(this.perspectiveCamera.fov * 0.5);\r\n        const distance = halfSizeToFitOnScreen / Math.tan(halfFovY);\r\n        return { boxCenter, distance };\r\n    }\r\n    adjustTarget() {\r\n        const cameraDir = new Vector3();\r\n        this.activeCamera.getWorldDirection(cameraDir);\r\n        cameraDir.multiplyScalar(20);\r\n        const center = new Vector3().addVectors(cameraDir, this.activeCamera.position);\r\n        this.orbitControls.target.set(center.x, center.y, center.z);\r\n    }\r\n    setupOrbitControls() {\r\n        this.orbitControls.enableDamping = true;\r\n        this.orbitControls.dampingFactor *= 2;\r\n        this.orbitControls.target.set(0, 0, 0);\r\n        const panWithMMB = this.context.options.panWithMMB || true;\r\n        if (panWithMMB) {\r\n            this.orbitControls.mouseButtons = {\r\n                RIGHT: MOUSE.RIGHT,\r\n                MIDDLE: MOUSE.RIGHT,\r\n                LEFT: MOUSE.LEFT\r\n            };\r\n        }\r\n    }\r\n}\r\n//# sourceMappingURL=OrbitControl.js.map"]},"metadata":{},"sourceType":"module"}